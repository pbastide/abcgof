<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Prior Goodness of Fit test — gfit • abcgof</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Prior Goodness of Fit test — gfit"><meta name="description" content="This function performs a prior Goodness of Fit (GoF) test,
that checks whether we can reject the hypothesis that the target
is from the same model as the particles from the sumstat matrix.
It works by sub-sampling nb.replicate points from the
reference table sumstat, and then by comparing the score of the
target with the distribution of scores of the calibration points."><meta property="og:description" content="This function performs a prior Goodness of Fit (GoF) test,
that checks whether we can reject the hypothesis that the target
is from the same model as the particles from the sumstat matrix.
It works by sub-sampling nb.replicate points from the
reference table sumstat, and then by comparing the score of the
target with the distribution of scores of the calibration points."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">abcgof</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/gaussian_laplace.html">Tutorial</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Prior Goodness of Fit test</h1>

      <div class="d-none name"><code>gfit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function performs a prior Goodness of Fit (GoF) test,
that checks whether we can reject the hypothesis that the <code>target</code>
is from the same model as the particles from the <code>sumstat</code> matrix.</p>
<p>It works by sub-sampling <code>nb.replicate</code> points from the
reference table <code>sumstat</code>, and then by comparing the score of the
<code>target</code> with the distribution of scores of the calibration points.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gfit</span><span class="op">(</span></span>
<span>  <span class="va">target</span>,</span>
<span>  <span class="va">sumstat</span>,</span>
<span>  nb.replicate <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lof"</span>, <span class="st">"kNN"</span><span class="op">)</span>,</span>
<span>  k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">14</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  k_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span>,</span>
<span>  norm <span class="op">=</span> <span class="va">sd</span>,</span>
<span>  ncores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  nboot <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'gfit'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'gfit'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">object</span>, score <span class="op">=</span> <span class="st">"lof"</span>, k <span class="op">=</span> <span class="st">"max"</span>, level <span class="op">=</span> <span class="fl">0.95</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'gfitsummary'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-target">target<a class="anchor" aria-label="anchor" href="#arg-target"></a></dt>
<dd><p>a matrix of observations, with dimension Nobs x Nstats.</p></dd>


<dt id="arg-sumstat">sumstat<a class="anchor" aria-label="anchor" href="#arg-sumstat"></a></dt>
<dd><p>a matrix of summary statistics from the training set,
with dimension Ntrain x Nstats.</p></dd>


<dt id="arg-nb-replicate">nb.replicate<a class="anchor" aria-label="anchor" href="#arg-nb-replicate"></a></dt>
<dd><p>number of replicates to draw from the training set for the calibration of the p value.</p></dd>


<dt id="arg-score">score<a class="anchor" aria-label="anchor" href="#arg-score"></a></dt>
<dd><p>the score to use for calling outliers. Can be "lof", "kNN", or both.</p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>The kth-distance to be used to calculate LOFs of kNNs.
k can be a vector which contains multiple k values based on which the score needs to be calculated.</p></dd>


<dt id="arg-k-range">k_range<a class="anchor" aria-label="anchor" href="#arg-k-range"></a></dt>
<dd><p>A vector of min and max values for k when using the "LOF max" score (see Details).</p></dd>


<dt id="arg-norm">norm<a class="anchor" aria-label="anchor" href="#arg-norm"></a></dt>
<dd><p>the normalization function. Default to <code><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></code>.</p></dd>


<dt id="arg-ncores">ncores<a class="anchor" aria-label="anchor" href="#arg-ncores"></a></dt>
<dd><p>number of cores for parallel computations.</p></dd>


<dt id="arg-nboot">nboot<a class="anchor" aria-label="anchor" href="#arg-nboot"></a></dt>
<dd><p>number of bootstrap replicates (see Details). Default to 1: no bootstrap replicate.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>an object used to select a method.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>further arguments passed to or from other methods.</p></dd>


<dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>an object for which a summary is desired.</p></dd>


<dt id="arg-level">level<a class="anchor" aria-label="anchor" href="#arg-level"></a></dt>
<dd><p>the level for the confidence interval</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>gfit</code>. For each score, it contains a list with:</p><ul><li><p><code>score.calib</code> a matrix of LOF scores for the calibration data (rows), for each possible value of k (if <code>nboot=1</code>).</p></li>
<li><p><code>score.test</code> a matrix of LOF scores for the test data (rows), for each possible value of k (if <code>nboot=1</code>).</p></li>
<li><p><code>pval</code> a matrix of p-values for the test data (rows), for each possible value of k (if <code>nboot=1</code>),
or an array of such matrices (if <code>nboot&gt;1</code>).</p></li>
<li><p><code>n.ref</code> the number of particles in the reference dataset (number of rows of <code>sumstat</code>).</p></li>
<li><p><code>n.calib</code> the number of particles used for calibration (equal to <code>nb.replicate</code>).</p></li>
<li><p><code>n.boot</code> the number of bootstrap replicates.</p></li>
<li><p><code>k_range</code> the min and max values for k when using the "LOF max" score.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The LOF and kNN scores are computations rely on the
function <code><a href="https://rdrr.io/pkg/dbscan/man/kNN.html" class="external-link">kNN</a></code> from the <code>dbscan</code> package.</p>
<p><code>target</code> can be a matrix, in which case the GoF test is performed independently
for each observation vector (rows of the matrix).</p>
<p>When using the "LOF max" statistics, the maximum LOF score over <code>k_range</code>
is taken for all calibration and observation points.</p>
<p>When <code>nboot&gt;1</code>, the test is performed several times, by drawing <code>nboot</code>
different sets of <code>nb.replicates</code> calibration points.
Highest Density Intervals are then computed using the
<code><a href="https://rdrr.io/pkg/HDInterval/man/hdi.html" class="external-link">hdi</a></code> function from package <code>HDInterval</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Le Mailloux G., Bastide, P., Marin, J-M., Estoup, A. (2024+),
Goodness of Fit for Bayesian Generative Models with Applications in Population Genetics.</p>
<p>Markus M. Breunig, Hans-Peter Kriegel, Raymond T. Ng, and Jörg Sander. 2000.
LOF: identifying density-based local outliers. SIGMOD Rec. 29, 2 (June 2000), 93–104.
https://doi.org/10.1145/335191.335388</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code>summary.gfit()</code> for summarizing the results;
<code><a href="gof.fit.html">gof.fit()</a></code> for prior GoF computation with fixed calibration points;
<code><a href="hpgfit.html">hpgfit()</a></code> for post-inference holdout GoF test.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">gaussian_laplace</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## 1000 simulations from the Laplace dataset</span></span></span>
<span class="r-in"><span><span class="va">sumstat</span> <span class="op">&lt;-</span> <span class="va">gaussian_laplace</span><span class="op">$</span><span class="va">dataset_laplace</span><span class="op">$</span><span class="va">sim</span></span></span>
<span class="r-in"><span><span class="co">## 10 observations from the Gaussian dataset</span></span></span>
<span class="r-in"><span><span class="va">target</span> <span class="op">&lt;-</span> <span class="va">gaussian_laplace</span><span class="op">$</span><span class="va">dataset_gaussian</span><span class="op">$</span><span class="va">sim</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Apply gfit</span></span></span>
<span class="r-in"><span><span class="va">resgfit</span> <span class="op">&lt;-</span> <span class="fu">gfit</span><span class="op">(</span><span class="va">target</span>, <span class="va">sumstat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">resgfit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Prior GoF analysis</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Using the lof with k = max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of lines in the reference table: 900 ;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of calibration point: 100 ;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Range of k values in the original object: k in [2, 20] ;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of target observations: 10 ;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Table of estimate, lower and upper 95% confidance interval pvalues:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       estim        lwr       upr</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,]  0.00 0.00000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,]  0.00 0.00000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,]  0.00 0.00000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,]  0.01 0.00000000 0.0295014</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,]  0.00 0.00000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,]  0.12 0.05630871 0.1836913</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,]  0.00 0.00000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,]  0.00 0.00000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,]  0.00 0.00000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,]  0.00 0.00000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Confidence intervals are based on asymptotic standard error estimation.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Apply gfit with bootstrap</span></span></span>
<span class="r-in"><span><span class="va">resgfit</span> <span class="op">&lt;-</span> <span class="fu">gfit</span><span class="op">(</span><span class="va">target</span>, <span class="va">sumstat</span>, nboot <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># nboot should be larger</span></span></span>
<span class="r-in"><span><span class="va">resgfit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Prior GoF analysis</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Using the lof with k = max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of lines in the reference table: 1000 ;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of calibration point: 100 ;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Range of k values in the original object: k in [2, 20] ;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of target observations: 10 ;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Table of median, lower and upper 95% HPD pvalues on 10 bootstrap replicates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       median lwr upr</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,]   0.00   0 0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,]   0.00   0 0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,]   0.00   0 0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,]   0.00   0 0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,]   0.00   0 0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,]   0.05   0 0.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,]   0.00   0 0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,]   0.00   0 0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,]   0.00   0 0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,]   0.00   0 0.0</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul Bastide, Arnaud Estoup, Guillaume Le Mailloux, Jean-Michel Marin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

